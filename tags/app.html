<app>
    <header>
        <div layout layout-align="start start">
            <img width="175" src="img/flexmaid.png" alt="" />
            <div>
                <h1>Flex Maid</h1>
                <span>
                    At your service
                </span>
            </div>
        </div>
    </header>
    <section>
        <div layout="column" layout-align="center">
            <form layout layout-align="space-around start">
                <input type="text" onkeyup={changeName} name="label" value="{breakpoint.label}"> {breakpoint.pixel}px
                <input type="submit" onclick={add} value="add">
            </form>
            <div class="slider" name="pixelSlider"></div>
        </div>
    </section>
    <section class="breakpoints">
        <breakpoint
        each={breakpoint, index in breakpoints}
        if={breakpoint.active}
        layout="row" layout-align="space-between"
        onclick={select}
        style="background-color: hsl(330, 50%, {50+(40/breakpoints.length)*index}%)"
        label="{breakpoint.label}"
        pixel="{breakpoint.pixel}">
        </breakpoint>
    </section>
    <script>
        this.breakpoints = [
            {
                label: 'sm',
                pixel: 640,
                active: true
            },
            {
                label: 'md',
                pixel: 960,
                active: true
            },
            {
                label: 'lg',
                pixel: 1280,
                active: true
            },
            {
                label: 'xl',
                pixel: 1920,
                active: false
            },
        ]

        this.breakpoint = this.breakpoints[3]

        changeName(e) {
            this.breakpoint.label = e.target.value
        }

        select(e) {
            this.breakpoint = e.item.breakpoint
        }

        add(e) {
            var equallyLabeledItems = this.breakpoints.filter((item) => {
                return item.label === this.breakpoint.value
            })
            var pixel = this.breakpoint.pixel
            if (!equallyLabeledItems.length && this.label.value.length) {
                var breakpointPushIndex = 0
                this.breakpoints.filter((item, index) => {
                    if (pixel >= item.pixel) {
                        breakpointPushIndex = index + 1
                    }
                })
                console.log(breakpointPushIndex + ' - ' + pixel);
                this.breakpoint.active = true
                this.breakpoint = {
                    label: this.label.value,
                    pixel: pixel,
                    active: true

                }
                this.breakpoints.splice(breakpointPushIndex, 0, this.breakpoint)
            }
        }

        this.on('mount', () => {
            this.noUiSlider.create(this.pixelSlider, {
            	start: [this.pixel],
            	range: {
            		'min': 320,
            		'max': 1920
            	},
                step: 32,
                pips: {
                    mode: 'count',
                    values: 6,
                    density: 2
                }
            })

            this.pixelSlider.noUiSlider.on('update', () => {
                this.breakpoint.pixel = this.pixelSlider.noUiSlider.get() | 0
                this.update()
            })
        })


        this.on('remove', (breakpoint) => {
            this.breakpoints = this.breakpoints.filter((bp) => {
                return breakpoint.opts.label != bp.label
            })
        })
    </script>
</app>
