<app>
    <header>
        <div layout layout-align="start start">
            <img width="175" src="img/flexmaid.png" alt="" />
            <div>
                <h1>Flex Maid</h1>
                <span>
                    At your service
                </span>
            </div>
        </div>
    </header>
    <section>
        <div layout="column" layout-align="center">
            <form layout layout-align="space-around start">
                <input type="text" value="xl" name="label"> {pixel}px
                <input type="submit" onclick={add} name="name" value="add">
            </form>
            <div class="slider" name="pixelSlider"></div>
        </div>
    </section>
    <section class="breakpoints">
        <breakpoint
        each={breakpoint, index in breakpoints}
        layout="row" layout-align="space-between"
        style="background-color: hsl(330, 50%, {25+(50/breakpoints.length)*index}%)"
        label="{breakpoint.label}"
        pixel="{breakpoint.pixel}">

        </breakpoint>
    </section>
    <script>
        this.breakpoints = [
            {
                label: 'sm',
                pixel: 640
            },
            {
                label: 'md',
                pixel: 960
            },
            {
                label: 'lg',
                pixel: 1280
            },
        ]

        this.pixel = 1600

        add(e) {
            var equallyLabeledItems = this.breakpoints.filter((item) => {
                return item.label === this.label.value
            })
            var pixel = this.pixel
            if (!equallyLabeledItems.length && this.label.value.length) {
                var breakpointPushIndex = 0
                this.breakpoints.filter((item, index) => {
                    if (pixel >= item.pixel) {
                        breakpointPushIndex = index + 1
                    }
                })
                console.log(breakpointPushIndex + ' - ' + pixel);
                this.breakpoints.splice(breakpointPushIndex, 0, {
                    label: this.label.value,
                    pixel: pixel
                })
            }
        }

        this.on('mount', () => {
            console.log(this)
            this.noUiSlider.create(this.pixelSlider, {
            	start: [this.pixel],
            	range: {
            		'min': 320,
            		'max': 1920
            	},
                step: 32,
                pips: {
                    mode: 'count',
                    values: 6,
                    density: 2
                }
            })

            this.pixelSlider.noUiSlider.on('update', () => {
                this.pixel = this.pixelSlider.noUiSlider.get() | 0
                this.update()
            })
        })


        this.on('remove', (breakpoint) => {
            this.breakpoints = this.breakpoints.filter((bp) => {
                return breakpoint.opts.label != bp.label
            })
        })
    </script>
</app>
